<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>推导 Y 组合子</title>
  <meta name="description" content="The Litter Schemer 的第九章，不读到最后，大概你都不知道作者其实是在一步步地推导Y组全子。">
  <link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAMh/bAA4bHABP3OMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMzMAAAAAADMzMzMAAAADETMzETAAAAMRMzMRMAAAAzMzMzMwAAAAMzMzMwAAAAAzMzMzAAAAADMzMzMAAAAAMwAAMwAAAAMwAAADMAAAIwAAAAAyAAIgAAAAAAIgAAAAAAAAAAD//wAA//8AAP//AAD8PwAA8A8AAOAHAADgBwAA4AcAAPAPAADwDwAA8A8AAPPPAADn5wAAz/MAAJ/5AAD//wAA" rel="icon" type="image/x-icon" />
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/tech/2014/10/19/deriving-the-y-combinator.html">
  <link rel="alternate" type="application/rss+xml" title="jude&#39;s life" href="/feed.xml">
  
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">jude&#39;s life</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">关于</a>
          
        
          
          <a class="page-link" href="/category/">分类</a>
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">推导 Y 组合子</h1>
    <p class="post-meta"><time datetime="2014-10-19T00:47:38+08:00" itemprop="datePublished">Oct 19, 2014</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>The Litter Schemer 的第九章，不读到最后，大概你都不知道作者其实是在一步步地推导Y组全子。</p>

<p>什么是Y组合子？答案在<a href="http://zh.wikipedia.org/zh-cn/%E4%B8%8D%E5%8A%A8%E7%82%B9%E7%BB%84%E5%90%88%E5%AD%90">这里</a>。</p>

<p>看不懂？不要紧，记住Y组合子可以做什么就行了：<strong>Y 组合子让我们可以定义匿名的递归函数</strong>。</p>

<p>以下推导采用来自 The Little Schemer 的例子，并为每一步加上注解。</p>

<p>嘿喂狗！</p>

<p>假设我们要写一个求列表长度的 length 函数，很简单是不是？我们之前已经写过了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(define length
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				add1 (length (cdr list))))))
</code></pre>
</div>

<p>刚才我们定义了一个叫 length 的函数，现在假设我们不能给这个函数命名，只能使用匿名函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (??? (cdr list))))))
</code></pre>
</div>

<p>忽然间，我们没有办法递归调用上面这个匿名函数了。<code class="highlighter-rouge">???</code>是什么意思呢？原本这是函数名字，但匿名函数没有名字嘛～</p>

<p>现在我们唯一可以做的就是用 整个匿名函数 替换 <code class="highlighter-rouge">???</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (

	(lambda (list)							; the
		(cond								;
			((null? list) 0)				; function
			(else							; 
				(add1 (??? (cdr list))))))	; itself

			 (cdr list))))))
</code></pre>
</div>

<p>虽然这是一个治标不治本的方法，因为<code class="highlighter-rouge">???</code>还藏在函数里面。但这个函数已经可以用来求长度为1或0的列表长度了。如果我们重复上一步：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (
		(lambda (list)							; the
			(cond								;
				((null? list) 0)				; function
				(else							;
					(add1 (??? (cdr list))))))	; itself
				 (cdr list))))))
			 (cdr list))))))
</code></pre>
</div>

<p>现在这个函数可以用来求长度为0,1,2的列表长度了，你可以这样一直替换下去，直到天荒地老。但这样会很累。而且函数里有大量重复的代码，这样很不好。</p>

<p>我们还是想想别的办法吧。首先，我们把引发重复代码的源头<code class="highlighter-rouge">???</code>从函数中提出来，把它当作函数的参数再传进去：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (length)
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (length (cdr list)))))))
???)
</code></pre>
</div>

<p>上面的代码首先调用了<code class="highlighter-rouge">lambda (length)</code>函数，并且把<code class="highlighter-rouge">???</code>当作参数传进去，最终返回了另一个匿名函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (??? (cdr list))))))
</code></pre>
</div>

<p>你没看错，这就是我们最初的那个匿名函数。现在我们用同样的方法——用整个匿名函数替换`???——重写一下可以求长度为0,1列表长度的匿名函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (f)
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (f (cdr list)))))))
 ((lambda (g)
	 (lambda (list)
		 (cond
			 ((null? list) 0)
			 (else
				 (add1 (g (cdr list)))))))
???))
</code></pre>
</div>

<p>上面的代码首先把<code class="highlighter-rouge">???</code>传给<code class="highlighter-rouge">lambda(g)</code>函数，然后把返回的函数——就是最初的匿名函数——传给<code class="highlighter-rouge">lambda(f)</code>，最终得到：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (??? (cdr list))))))
			 (cdr list))))))
</code></pre>
</div>

<p>上面的代码是不是很眼熟？它就是之前那个可以求长度为0,1的列表长度的函数，运用同样的方法可以得到求长度为0,1,2的列表长度的函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (f)
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (f (cdr list)))))))
 ((lambda (g)
	 (lambda (list)
		 (cond
			 ((null? list) 0)
			 (else
				 (add1 (g (cdr list)))))))
  ((lambda (h)
	  (lambda (list)
		  (cond
			  ((null? list) 0)
			  (else
				  (add1 (h (cdr list)))))))
???)))
</code></pre>
</div>

<p>因为函数的参数名字叫什么都没关系，我们不妨把<code class="highlighter-rouge">f,g,h</code>改成更有意义的名字：<code class="highlighter-rouge">length</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (length)
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (length (cdr list)))))))
 ((lambda (length)
	 (lambda (list)
		 (cond
			 ((null? list) 0)
			 (else
				 (add1 (length (cdr list)))))))
  ((lambda (length)
	  (lambda (list)
		  (cond
			  ((null? list) 0)
			  (else
				  (add1 (length (cdr list)))))))
???)))
</code></pre>
</div>

<p>到这步，我们又写了重复的代码。再一次，我们把重复的部分提出来，写一个<code class="highlighter-rouge">mk-length</code>函数帮我们生成<code class="highlighter-rouge">length</code>函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length ???))
 (lambda (length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 (length (cdr list))))))))
</code></pre>
</div>

<p>仔细观察上面的代码，<code class="highlighter-rouge">(lambda (mk-length) ...)</code>函数把<code class="highlighter-rouge">(lambda (length) ...)</code>函数当作<code class="highlighter-rouge">mk-length</code>参数传进去了。而<code class="highlighter-rouge">(lambda (length) ...)</code>函数则把<code class="highlighter-rouge">???</code>当作<code class="highlighter-rouge">length</code>参数，返回最初的匿名函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (??? (cdr list))))))
</code></pre>
</div>

<p>我们利用<code class="highlighter-rouge">mk-length</code>再次重写一下求长度为1的列表长度的函数，只需要对原<code class="highlighter-rouge">mk-length</code>函数的参数<code class="highlighter-rouge">???</code>再调用一次<code class="highlighter-rouge">mk-length</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length 
		(mk-length ???)))
 (lambda (length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 (length (cdr list))))))))
</code></pre>
</div>

<p>分析上面的代码，首先我们把<code class="highlighter-rouge">(lambda (length) ...)</code>函数当作<code class="highlighter-rouge">mk-length</code>参数传进<code class="highlighter-rouge">(lambda (mk-length) ...)</code>函数。这样得到的函数将把<code class="highlighter-rouge">(mk-length ???)</code>返回的结果当成参数，还记得<code class="highlighter-rouge">(mk-length ???)</code>返回什么吧？没错，就是最初的那个匿名函数。上面的代码展开之后就成了可以求长度为0,1的列表长度的函数了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (list)
	(cond
		((null? list) 0)
		(else
			(add1 (
	(lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (??? (cdr list))))))
			 (cdr list))))))
</code></pre>
</div>

<p>类似地，可以写出求长度为0,1,2的列表长度的函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length 
		(mk-length
			(mk-length ???))))
 (lambda (length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 (length (cdr list))))))))
</code></pre>
</div>

<p>因为我们并不关心<code class="highlighter-rouge">???</code>到底是什么东西，不妨把它替换为<code class="highlighter-rouge">mk-length</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length mk-length))
 (lambda (length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 (length (cdr list))))))))
</code></pre>
</div>

<p>上面这个函数与原版的不同之外就只是原来是<code class="highlighter-rouge">???</code>的地方，现在是：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (length)
	 	(lambda (list)
	 		(cond
	 			((null? list) 0)
	 			(else
	 				(add1 (length (cdr list)))))))
</code></pre>
</div>

<p>但这不影响我们求长度为0的列表长度，因为根本用不着。让我们改一下函数的参数名字——之前我们做过类似的事情——把<code class="highlighter-rouge">length</code>改为<code class="highlighter-rouge">mk-length</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length mk-length))
 (lambda (mk-length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 (mk-length (cdr list))))))))
</code></pre>
</div>

<p>接下来我们要做最关键也是最神奇的一步，把最后面一个<code class="highlighter-rouge">mk-length</code>用<code class="highlighter-rouge">(mk-length mk-length)</code>替换：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length mk-length))
 (lambda (mk-length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 ((mk-length mk-length) (cdr list))))))))
</code></pre>
</div>

<p>上面的代码可以计算任意长度列表的长度哦，不信你试试下面这个：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(((lambda (mk-length)
	(mk-length mk-length))
 (lambda (mk-length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 ((mk-length mk-length) (cdr list))))))))
 '(a b c d e f g h i j))
</code></pre>
</div>

<p>如果上面的代码太复杂，不妨看看这个简化的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (m)
	(m m)
 (lambda (l)
 	(l l)))
</code></pre>
</div>

<p>上面的函数展开之后，还是得到自己！这样它就可以无限循环下去了。我们的<code class="highlighter-rouge">mk-length</code>函数也是类似的，只不过因为<code class="highlighter-rouge">list</code>长度会不断递减，所以函数最终会停下来。不过我们还没有得出Y组合子，我们还得把Y组合子与真正干活的那部分函数分离开来！</p>

<p>我们先来看看这个：<code class="highlighter-rouge">(mk-length mk-length)</code>，它以<code class="highlighter-rouge">(cdr list)</code>为参数，事实上，这与下面的函数等价：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(lambda (x)
	((mk-length mk-length) x))
</code></pre>
</div>

<p>用上面的函数替换<code class="highlighter-rouge">(mk-length mk-length)</code>，得到：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length mk-length))
 (lambda (mk-length)
 	(lambda (list)
 		(cond
 			((null? list) 0)
 			(else
 				(add1 (

 					(lambda (x)
						((mk-length mk-length) x))

 					(cdr list))))))))
</code></pre>
</div>

<p>然后我们故技重施，把<code class="highlighter-rouge">(lambda (x) ...)</code>提出来：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (mk-length)
	(mk-length mk-length))
 (lambda (mk-length)

 	((lambda (length) 								;
 		(lambda (list) 								;
 			(cond									;
 				((null? list) 0)					;
	 			(else 								;
	 				(add1 (length (cdr list)))))))	;

	(lambda (x)
		((mk-length mk-length) x)))))
</code></pre>
</div>

<p>来看看上面代码中间与其他代码隔开来的部分，这部分是真正”干活“的，我们把它提出来：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (le)
	((lambda (mk-length)
		(mk-length mk-length))
	 (lambda (mk-length)
		(le (lambda (x)
				((mk-length mk-length) x))))))
</code></pre>
</div>

 	(lambda (length) 								;
 		(lambda (list) 								;
 			(cond									;
 				((null? list) 0)					;
<div class="highlighter-rouge"><pre class="highlight"><code> 			(else 								;
 				(add1 (length (cdr list))))))))	;
</code></pre>
</div>

<p>就这样，我们得到了两部分代码，上一部分就是Y组合子，把<code class="highlighter-rouge">mk-length</code>重命名为<code class="highlighter-rouge">f</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((lambda (le)
	((lambda (f)
		(f f))
	 (lambda (f)
		(le (lambda (x)
				((f f) x))))))
</code></pre>
</div>

 	(lambda (length) 								;
 		(lambda (list) 								;
 			(cond									;
 				((null? list) 0)					;
<div class="highlighter-rouge"><pre class="highlight"><code> 			(else 								;
 				(add1 (length (cdr list))))))))	;
</code></pre>
</div>

<p>为方便以后使用，还可以把上半部分的代码定义为 <code class="highlighter-rouge">Y</code> 函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(define Y
	(lambda (le)
		((lambda (f) (f f))
			(lambda (f)
				(le (lambda (x) ((f f) x)))))))
</code></pre>
</div>

<p>最后，利用 <code class="highlighter-rouge">Y</code> 函数重写<code class="highlighter-rouge">length</code>函数：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>((Y (lambda (length)
	（lambda (list)
		(cond
			((null? list) 0)
			(else
				(add1 (length (cdr list)))))))
'(a b c d e f g h i j))
</code></pre>
</div>

<p><strong>参考文献</strong></p>

<ul>
  <li>
    <p>原文 <a href="http://www.catonmat.net/blog/derivation-of-ycombinator/">Deriving the Y-Combinator</a></p>
  </li>
  <li>
    <p><a href="http://a-shi.org/blog/2014/10/05/li-jie-y-combinator/">理解Y Combinator</a></p>
  </li>
</ul>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">jude&#39;s life</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              jude zhu
            
            </li>
            
            <li><a href="mailto:yiyizym@163.com">yiyizym@163.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/yiyizym"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">yiyizym</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>记录生活的点点滴滴
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
